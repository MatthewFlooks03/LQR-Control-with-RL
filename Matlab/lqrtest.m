clc
clear

state = [
 -5, 0,   -7, 0,   -10, 0,   0, 0,   0, 0,   0, 0
].';

[t,y] = ode45(@odefun2, [0,10], state)

figure(1)
hold on
plot(t,y(:,[1,3,5]) + [5, 7, 10])

yline(10)
yline(5)
yline(7)
% figure(2)
% plot(t,y(:,[2,4,6,8,10,12]))

function dydt = odefun2(t,y)

g=9.81;

A = [
    0, 1,   0, 0,   0, 0,   0, 0,   0, 0,   0, 0;
    0, 0,   0, 0,   0, 0,   0, 0,   g, 0,   0, 0;

    0, 0,   0, 1,   0, 0,   0, 0,   0, 0,   0, 0;
    0, 0,   0, 0,   0, 0,   -g, 0,   0, 0,   0, 0;

    0, 0,   0, 0,   0, 1,   0, 0,   0, 0,   0, 0;
    0, 0,   0, 0,   0, 0,   0, 0,   0, 0,   0, 0;

    0, 0,   0, 0,   0, 0,   0, 1,   0, 0,   0, 0;
    0, 0,   0, 0,   0, 0,   0, 0,   0, 0,   0, 0;

    0, 0,   0, 0,   0, 0,   0, 0,   0, 1,   0, 0;
    0, 0,   0, 0,   0, 0,   0, 0,   0, 0,   0, 0;

    0, 0,   0, 0,   0, 0,   0, 0,   0, 0,   0, 1;
    0, 0,   0, 0,   0, 0,   0, 0,   0, 0,   0, 0;
];


Ixx = 0.11;
Iyy = 0.11;
Izz = 0.04;
m = 1;

B=[
    0,   0,   0,   0;
    0,   0,   0,   0;
    0,   0,   0,   0;
    0,   0,   0,   0;
    0,   0,   0,   0;
    1/m,  0,   0,   0;     
    0,   0,   0,   0;
    0,   1/Ixx, 0,   0;
    0,   0,   0,   0;
    0,   0,   1/Iyy, 0;
    0,   0,   0,   0;
    0,   0,   0,   1/Izz;
];

C = [
    1,0,0,0,0,0,0,0,0,0,0,0;
    0,0,1,0,0,0,0,0,0,0,0,0;
    0,0,0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,0,0,1,0,0,0,0,0;
    0,0,0,0,0,0,0,0,1,0,0,0;
    0,0,0,0,0,0,0,0,0,0,1,0;
];

D = [
    0,0,0,0;
    0,0,0,0;
    0,0,0,0;
    0,0,0,0;
    0,0,0,0;
    0,0,0,0;
];

sys = ss(A,B,C,D);
    

Q = [
    1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0;
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
];

R = diag([1 1 1 1]);

[K,~,~] = lqr(sys,Q,R);

u = -K * y;

dydt = A*y + B*u;
end
